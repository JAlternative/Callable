# Основной скрипт

Это скрипт, выдающий подробные результаты нагрузочного тестирования:
1. Графики задержки по каждому запросу (в некоторых случаях с делением по сценариям - об этом ниже)
2. Таблицу со статистикой по показателям задержки и кодов ответа на каждый запрос.

### Условия для правильной работы
1. Заполненный по инструкции `config`. При `--mode=strict` (см. ниже о том, что он делает) это значит, что `config` 
должен содержать:
  * как минимум один профиль нагрузки. Для него обязательно заполнить поля `output_csv` (исходные данные) и 
`short_name` (название, которое будет использоваться для формирования листов в итоговом документе Excel). Опционально
заполнение `duration` и `user_count` - эти данные пойдут на титульную страницу документа. Если она не нужна, то можно 
оставить эти поля пустыми.
  * как минимум один сценарий. У него все поля должны быть заполнены.

При `--mode=lazy` необходимо указать только профиль нагрузки (правила те же, что и при `--mode=strict`).
## Запуск
`python main.py --profile=PROFILE --mode=MODE`, 
где 
* PROFILE = это названия профилей, по которым нужно нарисовать отчетность. Должны повторять названия разделов в конфиге
(в квадратных скобках). Можно указать несколько через точку с запятой. Пробелы после ";" не нужны!
* MODE = режим работы скрипта:
  * `strict` - когда надо проанализировать один или несколько прогонов с разными количествами пользователей, разными сценариями и т.д.
Требует тщательного заполнения конфига по инструкции в нем и правильного именования запросов и Transaction Controllerов (далее TC). 
В этой папке есть вспомогательные скрипты, которые помогут правильно переименовать запросы и проверить правильность именования. 
  * `lazy` - когда есть один прогон, запросы из которого можно свалить в одну кучу.

## Результат
В папке `xlsx` появится файл `LT report_PROFILE`, а в папке graphs - подпапка `PROFILE`. 
Если в `PROFILE` был список, то для каждого будет создан отдельный отчет и отдельная папка с графиками.
При `--mode=strict` внутри будет разделение на сценарии в соответствии с информацией из `config`.
В xlsx-файле будет титульная страница с информацией по профилю и списком страниц.

## Возможные доработки скрипта
* Список страниц на титульном листе при `mode=lazy` - на данный момент его составление пропускается.
* Подстановка ссылок на листы - сейчас их надо навешивать вручную.
* Общий рефактор: чтобы дважды не фильтровать запросы и не плодить бесконечные циклы, я совместила рисование графиков 
и сбор информации для отчетов, что может мешать пониманию происходящего. В идеале, эти вещи стоит разделить.


# Вспомогательные скрипты
## check_request_names_for_pattern.py
Проверяет, соответствуют ли названия запросов и TC регулярным выражениям, перечисленным в файле `config` (раздел `REGEX`,
параметры `request` и `controller` соответственно). Может пригодиться перед нагрузочным тестированием с целью проверить, 
что все запросы названы верно.

### Запуск
`python check_request_names_for_pattern.py --file=FILE`, где
* `FILE` - это название jmx-файла с нагрузочным скриптом из папки jmx. Расширение файла указывать не надо.
### Результат
Выводит в консоль список запросов, не соответствующих указанным регулярным выражениям. Пользователь сам определяет, какие
запросы необходимо переименовать по схеме, а какие можно оставить в текущем виде (если они не нужны в отчетности, например).

## jmx_renamer.py
### Условия для правильной работы
* Все запросы, связанные с индивидуальными шагами сценария, должны быть разложены по TC. 
* Такие TC должны быть названы по одной их следующих схем: 
  * `c${номер сценария}_s${номер шага в сценарии}` - для вспомогательных шагов типа авторизации
  * `c${номер сценария}_s${номер шага в сценарии} - ${название шага}` - для всх остальных случаев
* TC, соответствующие сценарию, должны назваться по схеме:
  * `c${номер сценария} - ${название сценария}`

### Запуск
`python jmx_renamer.py --file=FILE`, где
* `FILE` - это название jmx-файла с нагрузочным скриптом из папки jmx. Расширение файла указывать не надо.

### Результат
При выполнении этих условий скрипт переименует все HTTP-запорсы в сценарии по следующей схеме:
  * `c${номер сценария}_s${номер шага в сценарии}_r{номер запроса в шаге}_FB_{адрес, по которому идет запрос}`
Файл с переименованными запросами будет сохранен в папке jmx с постфиксом `_renamed`.

Далее нужно открыть скрипт в Jmeter и сделать поиск по строке FB. Оставить в запросах либо F, либо B в зависимости от того, 
на фронт идет запрос или на бэк.
Также важно проверить работу скрипта: он ориентируется только на названия TC (а не на вложенность элементов) 
и может сбиться со счета, если TC был назван неправильно. В этом случае лучше переименовать проблемные TC по указанной 
выше схеме и перезапустить скрипт.

### Возможные доработки скрипта
В отличие от другого вспомогательного скрипта, этот не опирается на `config`. Т.е., если понадобится изменить в конфиге
схему именования запросов, то надо будет перелопачивать весь этот скрипт. 
На данный момент не уверена, как от этого можно защититься.